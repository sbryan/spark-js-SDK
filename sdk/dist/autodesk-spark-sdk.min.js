/*! autodesk-spark-sdk v0.1.0 | (c) Autodesk, Inc. | 2015-07-14 | Apache 2.0 */
!function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j=c.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this);var ADSKSpark=ADSKSpark||{};!function(){"use strict";ADSKSpark.Constants={API_HOST_PROD:"https://api.spark.autodesk.com/api/v1",API_HOST_SANDBOX:"https://sandbox.spark.autodesk.com/api/v1",EXPORT_TASK_TYPE:"export",ERROR_TASK_STATUS:"error",RUNNING_TASK_STATUS:"running"}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";ADSKSpark.Helpers={popupWindow:function(a,b,c){var d=screen.width/2-b/2,e=screen.height/3-c/3;return window.open(a,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+b+", height="+c+", top="+e+", left="+d)},transformToAssocArray:function(a){var b=[];if(a)for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");b[e[0]]=e[1]}return b},extractParamsFromURL:function(a){return a=a||window.location.search.substr(1)||window.location.hash.substr(1),a?this.transformToAssocArray(a):[]},jsonToParameters:function(a,b){if(!a)return null;var c=Object.keys(a);return 0===c?null:(b&&(c=c.filter("function"==typeof b?b:Array.isArray(b)?function(a){return-1===b.indexOf(a)}:function(a){return a!==b})),c.map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&"))},isValidId:function(a){return a&&0===a%(!isNaN(parseFloat(a))&&a>=0)},isValidIds:function(a){if(!a)return!1;var b=a.toString().split(",");if(0===b.length)return!1;for(var c=0;c<b.length;c++)if(!this.isValidId(b[c]))return!1;return!0},mergeObjects:function(a,b){var c={};for(var d in a)c[d]=a[d];for(var e in b)c[e]=b[e];return c},changeHttpToHttps:function(a){return a&&a.indexOf("http:")>-1&&(a=a.replace("http:","https:")),a},extractRedirectionCode:function(a){var b=this.extractParamsFromURL(a);return b.code},extractRedirectionTokenData:function(a){var b=this.extractParamsFromURL(a),c={};return c.access_token=b.access_token,c.expires_in=b.expires_in,c},calculateRedirectUri:function(a){a||(a=window.location.href);var b=a.indexOf("?"),c=a.indexOf("#"),d=a;return b>-1?d=d.substring(0,b):c>-1&&(d=d.substring(0,c)),d}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";ADSKSpark.Request=function(a,b,c){c=c||{};var d=function(a,b,c,d){var f=new Promise(function(a){d&&"function"==typeof d?d().then(function(b){a(b)}):a(d)});return f.then(function(d){return e(a,b,c,d)})},e=function(b,d,e,f){d=d||{};var g="";if(e&&"GET"===b){var h=0;for(var i in e)e.hasOwnProperty(i)&&(h++&&(g+="&"),g+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));a+="?"+g,g=""}else g=e;var j=new Promise(function(e,h){var i=new XMLHttpRequest;i.open(b,a);for(var j in d)d.hasOwnProperty(j)&&i.setRequestHeader(j,d[j]);f&&!d.hasOwnProperty("Authorization")&&i.setRequestHeader("Authorization",f),c.notJsonResponse&&(i.responseType="arraybuffer"),c.withCredentials&&(i.withCredentials=!0),i.onload=function(){if(200===i.status||201===i.status||202===i.status||204===i.status){var a;204===i.status||c.notJsonResponse?(a={},a.arraybuffer=new Uint8Array(i.response)):a=JSON.parse(i.responseText),a.httpStatus=i.status,a.httpStatusText=i.statusText,e(a)}else{var b=new Error(i.statusText);b.status=i.status,b.statusText=i.statusText,b.responseText=i.responseText,h(b)}},i.onerror=function(){h(new Error("Error: "+a+" failed. Response:"+i.responseText))},i.send(g)});return j};return{get:function(a,c){return d("GET",a,c,b)},post:function(a,c){return d("POST",a,c,b)},put:function(a,c){return d("PUT",a,c,b)},"delete":function(a,c){return d("DELETE",a,c,b)}}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Helpers,b="spark-guest-token",c="spark-access-token",d="",e="",f="",g="",h="",i="",j=function(){return f?ADSKSpark.Request(f).get().then(function(a){var c=Date.now();return a.expires_at=c+1e3*parseInt(a.expires_in),localStorage.setItem(b,JSON.stringify(a)),a.access_token}):Promise.reject(new Error("No Server Implementation"))},k=function(a,b){var d={};d.access_token=a;var e=Date.now();return d.expires_at=e+1e3*parseInt(b),localStorage.setItem(c,JSON.stringify(d)),d.access_token},l=function(b){var d={code:b};return i?d.redirect_uri=i:d.redirect_uri=a.calculateRedirectUri(),g?ADSKSpark.Request(g,null,{withCredentials:!0}).get(void 0,d).then(function(a){if(a&&a.expires_in&&a.access_token){var b=Date.now();return a.expires_at=b+1e3*parseInt(a.expires_in),delete a.refresh_token,localStorage.setItem(c,JSON.stringify(a)),a.access_token}return Promise.reject(new Error(a.Error))}):Promise.reject(new Error("No Server Implementation"))};ADSKSpark.Client={initialize:function(a,b){d=a,e=b&&b.isProduction?ADSKSpark.Constants.API_HOST_PROD:ADSKSpark.Constants.API_HOST_SANDBOX,i=b&&b.redirectUri?b.redirectUri:null,f=b&&b.guestTokenUrl?b.guestTokenUrl:null,g=b&&b.accessTokenUrl?b.accessTokenUrl:null,h=b&&b.refreshTokenUrl?b.refreshTokenUrl:null},getLoginRedirectUrl:function(b,c){var f=c?"code":"token",g=i||a.calculateRedirectUri(),h=e+"/oauth/authorize?response_type="+f+"&client_id="+d+"&redirect_uri="+g;return b&&(h+="&register=true"),h},logout:function(){localStorage.removeItem(c)},isAccessTokenValid:function(){var a=JSON.parse(localStorage.getItem(c)),b=Date.now();return!!(a&&a.expires_at&&a.expires_at>b)},getAccessTokenObject:function(){var a=JSON.parse(localStorage.getItem(c));return a&&a.access_token?a:null},getAccessToken:function(){var a=JSON.parse(localStorage.getItem(c));return a&&a.access_token?a.access_token:null},getGuestToken:function(){var a=JSON.parse(localStorage.getItem(b)),c=Date.now();return a&&a.expires_at&&a.expires_at>c?Promise.resolve(a.access_token):j()},refreshAccessToken:function(){if(h){var a=this.getAccessTokenObject();return a?ADSKSpark.Request(h,null,{withCredentials:!0}).get().then(function(a){if(!a.Error){var b=Date.now();a.expires_at=b+1e3*parseInt(a.expires_in);var d=JSON.parse(JSON.stringify(a));delete d.refresh_token,localStorage.setItem(c,JSON.stringify(d))}return a}):Promise.reject(new Error("Access token does not exist, you need to login again"))}return Promise.reject(new Error("No Server Implementation"))},authorizedApiRequest:function(a,b){function d(a){return a?"Bearer "+a.access_token:null}var f=this;return b=b||{},ADSKSpark.Request(e+a,function(){return new Promise(function(a){var b=JSON.parse(localStorage.getItem(c));if(b){var e=Date.now();h&&b.expires_at&&e>b.expires_at?f.refreshAccessToken().then(function(b){a(d(b))}):a(d(b))}else a(null)})},b)},authorizedAsGuestApiRequest:function(a,b){var c=this;return b=b||{},ADSKSpark.Request(e+a,function(){return new Promise(function(a){c.getGuestToken().then(function(b){a(b?"Bearer "+b:null)})})},b)},openLoginWindow:function(b,c){a.popupWindow(this.getLoginRedirectUrl(b,c),350,600)},completeLogin:function(b){if(b){var c=a.extractRedirectionCode();return c?l(c):Promise.reject("No code supplied")}var d=a.extractRedirectionTokenData();return d&&d.access_token?Promise.resolve(k(d.access_token,d.expires_in)):Promise.reject("No access_token supplied")}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client;ADSKSpark.Paginated=function(a){this.parse(a)},ADSKSpark.Paginated.prototype=Object.create(Array.prototype),ADSKSpark.Paginated.prototype.constructor=ADSKSpark.Paginated,ADSKSpark.Paginated.prototype.hasPrev=function(){return this.data&&!!this.data._link_prev},ADSKSpark.Paginated.prototype.prev=function(){if(this.data){var b=this.data._link_prev,c=this;if(b)return a.authorizedApiRequest(b).get().then(function(a){return c.parse(a),c})}return Promise.reject(new Error("no prev link"))},ADSKSpark.Paginated.prototype.hasNext=function(){return this.data&&!!this.data._link_next},ADSKSpark.Paginated.prototype.next=function(){if(this.data){var b=this.data._link_next,c=this;if(b)return a.authorizedApiRequest(b).get().then(function(a){return c.parse(a),c})}return Promise.reject(new Error("no next link"))},ADSKSpark.Paginated.prototype.parse=function(a){this.splice(0,this.length),this.data=a}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client;ADSKSpark.Jobs=function(a){ADSKSpark.Paginated.call(this,a)},ADSKSpark.Jobs.prototype=Object.create(ADSKSpark.Paginated.prototype),ADSKSpark.Jobs.prototype.constructor=ADSKSpark.Jobs,ADSKSpark.Jobs.get=function(b,c){return a.authorizedApiRequest("/print/jobs").get(b,c).then(function(a){return new ADSKSpark.Jobs(a)})},ADSKSpark.Jobs.getPrinter=function(b,c,d){return a.authorizedApiRequest("/print/printers/"+b+"/jobs").get(c,d).then(function(a){return new ADSKSpark.Jobs(a)})},ADSKSpark.Jobs.prototype.parse=function(a){if(ADSKSpark.Paginated.prototype.parse.call(this,a),a){var b=a.jobs||a.printer_jobs;if(Array.isArray(b)){var c=this;b.forEach(function(b){b.printer_id||(b.printer_id=a.printer_id),b.member_id||(b.member_id=a.member_id),c.push(new ADSKSpark.Job(b))})}}},ADSKSpark.Job=function(a){this.status=null,this.progress=0,a&&(this.id=a.job_id,this.printer_id=a.printer_id,this.status=a.job_status?a.job_status.job_status:null,this.progress=a.job_status?a.job_status.job_progress:0,this.data=a)},ADSKSpark.Job.prototype={constructor:ADSKSpark.Job,getStatus:function(){if(!this.id)return Promise.reject(new Error("Job does not exist."));var b=this;return a.authorizedApiRequest("/print/jobs/"+this.id).get().then(function(a){return a.hasOwnProperty("printer_id")&&(b.printer_id=a.printer_id),b.status=a.job_status?a.job_status.job_status:null,b.progress=a.job_status?a.job_status.job_progress:0,b.data=a,b})["catch"](function(a){throw b.status=null,a})},createWithProfile:function(a,b,c){return this.createWithSettings({profile_id:a},b,c)},createWithSettings:function(b,c,d){function e(a){return f.id=a.job_id,f.getStatus()}if(this.id)return Promise.reject(new Error("Job already exists."));var f=this;c=c||0;var g={"Content-Type":"application/json"},h={settings:b};return d&&(h.printable_id=d),a.authorizedApiRequest("/print/printers/"+c+"/jobs").post(g,JSON.stringify(h)).then(e)},updateStatus:function(b,c,d){if(!this.id)return Promise.reject(new Error("Unknown job in updateStatus."));if(b&&(b=b.toLowerCase(),"success"!==b&&"failed"!==b))return Promise.reject(new Error("Invalid job status in updateStatus."));var e,f,g=this,h=encodeURIComponent(b||""),i=encodeURIComponent(c||"");return d&&(e={"Content-Type":"application/json"},f=JSON.stringify(d)),a.authorizedApiRequest("/print/jobs/"+this.id+"?status="+h+"&comment="+i).put(e,f).then(function(a){return console.log("updateStatus GOT: "+JSON.stringify(a)),g.getStatus()})},setPrintable:function(b){if(!this.id)return Promise.reject(new Error("Unknown job in setPrintable."));if(!b)return Promise.reject(new Error("Must provide printable file ID for setPrintable."));var c=this,d={"Content-Type":"application/json"},e=JSON.stringify({printable_id:b});return a.authorizedApiRequest("/print/jobs/"+this.id+"/printable").post(d,e).then(function(a){return a.printer_id&&(c.printer_id=a.printer_id),a.status&&(c.status=a.status),console.log("setPrintable GOT: "+JSON.stringify(a)),c.getStatus()})},setPrinter:function(b){if(!this.id)return Promise.reject(new Error("Unknown job in setPrinter."));if(!b)return Promise.reject(new Error("Must provide printer for setPrinter."));var c=this,d={"Content-Type":"application/json"},e=JSON.stringify({printer_id:b});return a.authorizedApiRequest("/print/jobs/"+this.id+"/printer").post(d,e).then(function(a){return a.printer_id&&(c.printer_id=a.printer_id),a.status&&(c.status=a.status),console.log("setPrinter GOT: "+JSON.stringify(a)),c.getStatus()})},setCallback:function(b){return a.authorizedApiRequest("/print/jobs/"+this.id+"/register").post(null,{callback_url:b})},updateCustomData:function(b){if(!this.id)return Promise.reject(new Error("Unknown job in updateCustomData."));if(!b)return Promise.reject(new Error("Custom data required for updateCustomData."));var c=this,d={"Content-Type":"application/json"},e=JSON.stringify(b);return a.authorizedApiRequest("/print/jobs/"+this.id).put(d,e).then(function(a){return console.log("updateCustomData GOT: "+JSON.stringify(a)),c.getStatus()})},setSourceTray:function(a){return this.id?(this.data.job_custom_data||(this.data.job_custom_data={}),this.data.job_custom_data.ADSKSpark||(this.data.job_custom_data.ADSKSpark={}),this.data.job_custom_data.ADSKSpark.source_tray=a,this.updateCustomData(this.data.job_custom_data)):Promise.reject(new Error("Unknown job in setSourceTray."))},getSourceTray:function(){var a=this.data.job_custom_data;return a&&a.ADSKSpark?a.ADSKSpark.source_tray:null},setMeshPaths:function(a){return this.id?(a||(a=[]),this.data.job_custom_data||(this.data.job_custom_data={}),this.data.job_custom_data.ADSKSpark||(this.data.job_custom_data.ADSKSpark={}),this.data.job_custom_data.ADSKSpark.source_files=a,this.updateCustomData(this.data.job_custom_data)):Promise.reject(new Error("Unknown job in setMeshPaths."))},getMeshPaths:function(){var a=this.data.job_custom_data;return a&&a.ADSKSpark?a.ADSKSpark.source_files:[]}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client;ADSKSpark.Printers=function(a){ADSKSpark.Paginated.call(this,a)},ADSKSpark.Printers.prototype=Object.create(ADSKSpark.Paginated.prototype),ADSKSpark.Printers.prototype.constructor=ADSKSpark.Printers,ADSKSpark.Printers.get=function(b){return a.authorizedApiRequest("/print/printers").get(null,b).then(function(a){return new ADSKSpark.Printers(a)})},ADSKSpark.Printers.prototype.parse=function(a){if(ADSKSpark.Paginated.prototype.parse.call(this,a),a){var b=a.printers;if(Array.isArray(b)){var c=this;b.forEach(function(a){c.push(new ADSKSpark.Printer(a))})}}},ADSKSpark.PrinterMembers=function(a){ADSKSpark.Paginated.call(this,a)},ADSKSpark.PrinterMembers.prototype=Object.create(ADSKSpark.Paginated.prototype),ADSKSpark.PrinterMembers.prototype.constructor=ADSKSpark.PrinterMembers,ADSKSpark.PrinterMembers.prototype.parse=function(a){if(ADSKSpark.Paginated.prototype.parse.call(this,a),a){var b=a.members;if(Array.isArray(b)){var c=this;b.forEach(function(a){c.push(a)})}}},ADSKSpark.Printer=function(a){this.printer_id=this.id=a.printer_id||a.id,this.printer_name=this.name=a.printer_name||a.name,this.firmware=a.firmware,this.type_id=a.type_id,this.is_primary=a.is_primary,this.printer_last_health=a.printer_last_health,this.data=a,this.status=null},ADSKSpark.Printer.register=function(b,c,d){var e={"Content-Type":"application/json"},f=JSON.stringify({printer_name:b,registration_code:c,secondary_member_id:d});return a.authorizedApiRequest("/print/printers/register").post(e,f).then(function(a){return a.registered?ADSKSpark.Printer.getById(a.printer_id):Promise.reject(new Error("not registered"))})},ADSKSpark.Printer.getById=function(b){return a.authorizedApiRequest("/print/printers/"+b).get().then(function(a){return new ADSKSpark.Printer(a)})},ADSKSpark.Printer.prototype={constructor:ADSKSpark.Printer,getStatus:function(){var b=this;return a.authorizedApiRequest("/print/printers/status/"+this.printer_id).get().then(function(a){return b.status=a,a})["catch"](function(a){throw b.status=null,a})},isOnline:function(){return this.status||"Offline"!==this.data.printer_last_health},isPrinting:function(){var a=(((this.status||{}).last_reported_state||{}).data||{}).state;return/^(?:Exposing|Printing|Printing Layer|Separating)$/.test(a)},pause:function(a){var b=a instanceof ADSKSpark.Job?a.id:a;return this.sendCommand("pause",{job_id:b})},resume:function(a){var b=a instanceof ADSKSpark.Job?a.id:a;return this.sendCommand("resume",{job_id:b})},cancel:function(a){var b=a instanceof ADSKSpark.Job?a.id:a;return this.sendCommand("cancel",{job_id:b})},reset:function(){return this.sendCommand("reset")},calibrate:function(){return this.sendCommand("calibrate")},firmwareUpgrade:function(a){return this.sendCommand("firmware_upgrade",{package_url:a})},log:function(){return this.sendCommand("log")},home:function(){return this.sendCommand("home")},park:function(){return this.sendCommand("park")},sendCommandAndWait:function(a,b,c){this.sendCommand(a,b).then(function(a){return this.waitForCommand(a.task_id,c)}).then(function(a){return a})},sendCommand:function(b,c){c=c||{},c.command=b;var d={"Content-Type":"application/json"};return c=JSON.stringify(c),a.authorizedApiRequest("/print/printers/"+this.printer_id+"/command").post(d,c).then(function(a){return a})},waitForCommand:function(b,c){c=c||{};var d=c.freq||1e3,e=c.timeout||1e4,f=+new Date,g="/print/printers/command/"+b;return new Promise(function(b,h){var i=setInterval(function(){a.authorizedApiRequest(g).get().then(function(a){var d=((a||{}).data||{}).is_error;if(d)clearInterval(i),h(new Error(a.error_message));else if(c.progressHandler&&c.progressHandler(a),a&&1<=a.progress)clearInterval(i),b(a);else{var g=+new Date;g-f>=e&&(clearInterval(i),h(new Error("timeout")))}})["catch"](function(a){clearInterval(i),h(a)})},d)})},setMemberRole:function(b,c,d){if(this.is_primary){var e={"Content-Type":"application/json"},f=JSON.stringify({secondary_member_id:b,is_printer_scoped:c,is_job_scoped:d});return a.authorizedApiRequest("/print/printers/"+this.printer_id+"/member_role").post(e,f)}return Promise.reject(new Error("not printer owner"))},generateRegistrationCode:function(b){if(this.is_primary){var c={"Content-Type":"application/json"},d=JSON.stringify({secondary_member_email:b});return a.authorizedApiRequest("/print/printers/"+this.printer_id+"/secondary_registration").post(c,d).then(function(a){return a.registration_code})}return Promise.reject(new Error("not printer owner"))},getMembers:function(b){return a.authorizedApiRequest("/print/printers/"+this.printer_id+"/members").get(null,b).then(function(a){return new ADSKSpark.PrinterMembers(a)})},unregister:function(b){var c={"Content-Type":"application/json"},d=b?JSON.stringify({secondary_member_id:b}):null;return a.authorizedApiRequest("/print/printers/"+this.printer_id)["delete"](c,d)},getJobs:function(b){return a.authorizedApiRequest("/print/printers/"+this.printer_id+"/jobs").get(null,b).then(function(a){return new ADSKSpark.Jobs(a)})},createJob:function(b,c,d,e){var f={"Content-Type":"application/json"},g=JSON.stringify({printable_id:b,printable_url:c,settings:d,callback_url:e});return a.authorizedApiRequest("/print/printers/"+this.printer_id+"/jobs").post(f,g)},startJob:function(b){var c=b instanceof ADSKSpark.Job?b.id:b,d={"Content-Type":"application/json"},e=JSON.stringify({job_id:c});return a.authorizedApiRequest("/print/printers/"+this.printer_id+"/jobs").put(d,e)}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client,b=0,c=function(c,d,e,f){++b,d=d||"Mesh_"+b,f=f||[[1,0,0,0],[0,1,0,0],[0,0,1,0]];var g={"Content-Type":"application/json"},h=JSON.stringify({file_id:c.toString(),name:d,transform:f,generate_visual:!!e});return a.authorizedApiRequest("/geom/meshes/import").post(g,h)},d=function(b){var c=new FormData;return c.append(b.name,b),a.authorizedApiRequest("/files/upload").post(null,c)};ADSKSpark.MeshAPI={importMesh:function(a,b,d,e,f){var g=new ADSKSpark.TaskWaiter(f);return c(a,b,d,e).then(g.wait)},uploadFile:function(a,b){return d(a,b)},transformMesh:function(b,c){var d={"Content-Type":"application/json"},e=JSON.stringify({id:b,transform:c});return a.authorizedApiRequest("/geom/meshes/transform").post(d,e)},analyzeMesh:function(b,c){var d={"Content-Type":"application/json"},e=JSON.stringify({id:b}),f=new ADSKSpark.TaskWaiter(c);return a.authorizedApiRequest("/geom/meshes/analyze").post(d,e).then(f.wait)},repairMesh:function(b,c,d,e){var f={"Content-Type":"application/json"};void 0===c&&(c=!0);var g=JSON.stringify({id:b,all:c,generate_visual:!!d}),h=new ADSKSpark.TaskWaiter(e);return a.authorizedApiRequest("/geom/meshes/repair").post(f,g).then(h.wait)},generateVisual:function(b,c){var d={"Content-Type":"application/json"},e=JSON.stringify({id:b}),f=new ADSKSpark.TaskWaiter(c);return a.authorizedApiRequest("/geom/meshes/generateVisual").post(d,e).then(f.wait)},exportMesh:function(b,c,d){c=c||"stl_ascii";var e={"Content-Type":"application/json"},f=JSON.stringify({id:b,file_type:c}),g=new ADSKSpark.TaskWaiter(d);return a.authorizedApiRequest("/geom/meshes/export").post(e,f).then(g.wait)}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client;ADSKSpark.PrintDB={getPrinterType:function(b){return a.authorizedApiRequest("/printdb/printertypes/"+b).get()},getPrinterTypes:function(){return a.authorizedApiRequest("/printdb/printertypes").get().then(function(a){return a.printerTypes})},getMaterial:function(b){return b=b||"",a.authorizedApiRequest("/printdb/materials/"+b).get()},getProfile:function(b){return b=b||"",a.authorizedApiRequest("/printdb/profiles/"+b).get()}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client;ADSKSpark.TaskWaiter=function(b){var c,d,e=this;this._checkTaskResponse=function(a){return console.log("Task status: ",a.status,"progress:",a.progress),"done"===a.status?a.result:"error"===a.status?Promise.reject(a.error):(b&&b(a.progress),new Promise(function(a){setTimeout(function(){a()},d)}).then(e._pollTask))},this._pollTask=function(){return a.authorizedApiRequest("/print/tasks/"+c).get().then(e._checkTaskResponse)},this.wait=function(a,b){return 200===a.httpStatus?Promise.resolve(a):(b=b||100,10>b&&(b=10),c=a.id,d=b,e._pollTask())}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client;ADSKSpark.TrayAPI={createTray:function(b,c,d,e,f,g){var h=new ADSKSpark.TaskWaiter(g),i={"Content-Type":"application/json"},j={printer_type_id:b,profile_id:c,mesh_ids:d};return e&&(j.mesh_attrs=e),f&&(j.default_material_id=f),a.authorizedApiRequest("/print/trays").post(i,JSON.stringify(j)).then(h.wait)},prepareTray:function(b,c,d){var e=new ADSKSpark.TaskWaiter(d),f={"Content-Type":"application/json"},g=JSON.stringify({id:b,generate_visual:!!c});return a.authorizedApiRequest("/print/trays/prepare").post(f,g).then(e.wait)},generatePrintable:function(b,c){var d=new ADSKSpark.TaskWaiter(c),e={"Content-Type":"application/json"},f=JSON.stringify({id:b});return a.authorizedApiRequest("/print/trays/generatePrintable").post(e,f).then(d.wait)}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client,b=ADSKSpark.Helpers,c=48;ADSKSpark.Assets={getPublicAssetsByConditions:function(b){return b=b||{},b.limit=b.limit&&b.limit>0?b.limit:c,b.offset=b.offset&&b.offset>=0?b.offset:0,a.authorizedAsGuestApiRequest("/assets").get(null,b)},getPublicAsset:function(c){return b.isValidId(c)?a.authorizedAsGuestApiRequest("/assets/"+c).get():Promise.reject(new Error("Proper assetId was not supplied"))},getAsset:function(c){return b.isValidId(c)?a.authorizedApiRequest("/assets/"+c).get():Promise.reject(new Error("Proper assetId was not supplied"))},getMyAssets:function(d){if(a.isAccessTokenValid()){var e=a.getAccessTokenObject(),f=e.spark_member_id,g={limit:c,offset:0};d&&d.limit&&d.limit<=0&&delete d.limit,d&&d.offset&&d.offset<0&&delete d.offset;var h=b.mergeObjects(g,d);if(b.isValidId(f))return a.authorizedApiRequest("/members/"+f+"/assets").get(null,h)}return Promise.reject(new Error("Access token is invalid"))},createAsset:function(b){var c=ADSKSpark.Helpers.jsonToParameters(b),d={"Content-type":"application/x-www-form-urlencoded"};return a.authorizedApiRequest("/assets").post(d,c)},updateAsset:function(c){if(b.isValidId(c.assetId)){var d=c.assetId,e=ADSKSpark.Helpers.jsonToParameters(c,"assetId");return a.authorizedApiRequest("/assets/"+d).put(null,e)}return Promise.reject(new Error("Proper assetId was not supplied"))},removeAsset:function(c){return b.isValidId(c)?a.authorizedApiRequest("/assets/"+c)["delete"]():Promise.reject(new Error("Proper assetId was not supplied"))},retrieveAssetThumbnails:function(c){return b.isValidId(c)?a.authorizedApiRequest("/assets/"+c+"/thumbnails").get():Promise.reject(new Error("Proper assetId was not supplied"))},retrieveAssetSources:function(c){return b.isValidId(c)?a.authorizedApiRequest("/assets/"+c+"/sources").get():Promise.reject(new Error("Proper assetId was not supplied"))},createAssetThumbnails:function(c,d,e){if(b.isValidId(c)){var f=d.map(function(a){return{id:a.id,caption:a.caption||"",description:a.description||"",is_primary:a.is_primary||!1}});e=e||!1;var g="thumbnails="+JSON.stringify(f)+"&async="+e,h={"Content-type":"application/x-www-form-urlencoded"};return a.authorizedApiRequest("/assets/"+c+"/thumbnails").post(h,g)}return Promise.reject(new Error("Proper assetId was not supplied"))},createAssetSources:function(c,d){if(b.isValidId(c)){var e="file_ids="+d,f={"Content-type":"application/x-www-form-urlencoded"};return a.authorizedApiRequest("/assets/"+c+"/sources").post(f,e)}return Promise.reject(new Error("Proper assetId was not supplied"))},deleteAssetSources:function(c,d){if(b.isValidId(c)){var e="?file_ids="+d;return a.authorizedApiRequest("/assets/"+c+"/sources"+e)["delete"]()}return Promise.reject(new Error("Proper assetId was not supplied"))},deleteAssetThumbnails:function(c,d){if(b.isValidId(c)){var e="?thumbnail_ids="+d;return a.authorizedApiRequest("/assets/"+c+"/thumbnails"+e)["delete"]()}return Promise.reject(new Error("Proper assetId was not supplied"))}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client,b=ADSKSpark.Helpers;ADSKSpark.Files={getFileDetails:function(c){return b.isValidId(c)?a.authorizedApiRequest("/files/"+c).get():Promise.reject(new Error("Proper fileId was not supplied"))},uploadFile:function(b){var c=new FormData;c.append("file",b.file);var d=b.unzip?b.unzip:!1;return c.append("unzip",d),b["public"]&&c.append("public",b["public"]),a.authorizedApiRequest("/files/upload").post(null,c)},downloadFile:function(c){if(b.isValidIds(c)){var d={file_ids:c};return a.authorizedApiRequest("/files/download",{notJsonResponse:!0}).get(null,d)}return Promise.reject(new Error("Proper fileId(s) was not supplied"))},downloadPublicFile:function(c,d){if(b.isValidIds(c)&&b.isValidId(d)){var e={file_ids:c,asset_id:d};return a.authorizedAsGuestApiRequest("/files/download",{notJsonResponse:!0}).then(function(a){return a.get(null,e)})}return Promise.reject(new Error("Proper fileId(s) or assetId were not supplied"))},downloadFileByURL:function(c){if(b.isValidIds(c)){var d={file_ids:c};return a.authorizedApiRequest("/files/download/path").get(null,d)}return Promise.reject(new Error("Proper fileId(s) was not supplied"))}}}();var ADSKSpark=ADSKSpark||{};!function(){"use strict";var a=ADSKSpark.Client,b=ADSKSpark.Helpers;ADSKSpark.Members={getMemberProfile:function(c){return b.isValidId(c)?a.authorizedApiRequest("/members/"+c).get():Promise.reject(new Error("Proper memberId was not supplied"))},getMyProfile:function(){return a.authorizedApiRequest("/members").get()}}}();